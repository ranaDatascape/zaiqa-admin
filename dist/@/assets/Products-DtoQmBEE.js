import{j as e,r as m,f as t,t as R,S as J,i as q}from"./index-Cv0MCJep.js";import{g as M,e as $,f as z}from"./Layout-D-JsJcP2.js";import{u as V}from"./useToggleDrawer-C1UtrQV4.js";import{N as _}from"./NotFound-Kgr5jKYC.js";import{P as Y}from"./PageTitle-CDKo5HT-.js";import{u as E,a as G}from"./useGetDatas-DUx7WE11.js";import{S as F}from"./sweetalert2.esm.all-B0Dix5B2.js";import{L as H}from"./Loading-B8HNEKEf.js";import{u as W}from"./index.esm-CtzVagC9.js";import{n as O,a as C}from"./toast-DkhCIWt5.js";import{R as K}from"./quill.snow-5yXoS7a5.js";import{L as T}from"./LabelArea-Bb7qUJrU.js";import{M as X}from"./MainDrawer-D7Kypkxo.js";import{P as Z}from"./ProductDrawer-BUBDSLx0.js";import{A as ee,c as se}from"./browser-DAe6cXmg.js";import{P as Q}from"./ProductServices-8BRK73zt.js";import{u as te}from"./useDisableForDemo-DndbcQrQ.js";import"./DeleteModal-BtvCN7mm.js";import{B as re}from"./BulkActionDrawer-BLTFmZ0T.js";import{T as ae}from"./TableLoading-B7jc0TEa.js";import{A as le}from"./AnimatedContent-f_qjIjlx.js";import"./iconBase-CHzXLRSI.js";/* empty css                      */import"./spinner-CkndCogW.js";import"./index-LNM3yfuz.js";import"./Error-DhTYXBCu.js";import"./InputArea-C4k6rcIG.js";import"./InputValue-Caa3aWbn.js";import"./useAsync-Dx79ITIc.js";import"./CustomerServices-RCtKxH8V.js";import"./useTranslationValue-BxYdltS6.js";import"./index-CgSWhKad.js";import"./AdminServices-DHiG2Q7Q.js";import"./CouponServices-Bwlwibye.js";import"./CurrencyServices-BK8AbJu1.js";import"./Tree-B5pXmuyD.js";import"./Title-6CzNxVGl.js";import"./SelectLanguageTwo-DQqql4G2.js";import"./SwitchToggle-CYdqVLVE.js";import"./index.prod-dN6d4wYn.js";import"./TextAreaCom-BOROZaGH.js";import"./index-D52NM8LP.js";const ie=({isOpen:a,onClose:l,children:p})=>a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-3/4 relative",children:[e.jsx("button",{onClick:l,className:"absolute top-2 right-2 text-gray-500 hover:text-black",children:"✕"}),p]})}):null,oe="http://localhost:5055/api",ne=({product:a,onClose:l,refetch:p})=>{const w=E(),[u,g]=m.useState(null),[f,P]=m.useState(""),[c,S]=m.useState(!1),{register:o,handleSubmit:y,reset:s,setValue:N,formState:{errors:x},watch:A}=W({defaultValues:{productName:"",title:"",purchasePrice:"",salesPrice:"",productQuantity:"",description:""}});m.useEffect(()=>{a&&(s({productName:a.productName,title:a.title,purchasePrice:a.purchasePrice,salesPrice:a.salesPrice,productQuantity:a.productQuantity,description:a.description||""}),g(oe+a.image),P(a.description))},[a,s]);const v=A("image");m.useEffect(()=>{if(v&&v[0]){const r=v[0];g(URL.createObjectURL(r))}},[v]);const B=async r=>{var d,k,D,i,n,U;const j=new FormData;j.append("productName",((d=r.productName)==null?void 0:d.toString())||""),j.append("title",((k=r.title)==null?void 0:k.toString())||""),j.append("purchasePrice",((D=r.purchasePrice)==null?void 0:D.toString())||""),j.append("salesPrice",((i=r.salesPrice)==null?void 0:i.toString())||""),j.append("productQuantity",((n=r.productQuantity)==null?void 0:n.toString())||""),j.append("description",((U=r.description)==null?void 0:U.toString())||""),r.image&&r.image[0]&&j.append("image",r.image[0]),console.log("Submitting product update:",r);try{S(!0),(await w.patch(`/products/${a.id}?type=products`,j,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(O("Product updated successfully!"),p(),l())}catch(L){console.error("Failed to update product:",L)}finally{S(!1)}},h={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],[{color:[]},{background:[]}],["link","image","video"],["custom-check"]]},b=["header","bold","italic","underline","strike","list","bullet","script","indent","align","color","background","link","image","video"];return e.jsx(e.Fragment,{children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"relative bg-white rounded shadow-md p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:l,className:"absolute top-2 right-2 text-gray-500 hover:text-red-600 text-2xl font-bold",children:"×"}),e.jsxs("form",{onSubmit:y(B),className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold text-center",children:"Update Product"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(T,{label:"Product Name"}),e.jsx("input",{...o("productName",{required:"Product name is required"}),placeholder:"Product Name",className:"w-full p-2 border rounded"}),x.productName&&e.jsx("p",{className:"text-red-500",children:x.productName.message})]}),e.jsxs("div",{children:[e.jsx(T,{label:"Product Title"}),e.jsx("input",{...o("title",{required:"Product title is required"}),placeholder:"Product Title",className:"w-full p-2 border rounded"}),x.productName&&e.jsx("p",{className:"text-red-500",children:x.productName.message})]}),e.jsxs("div",{children:[e.jsx(T,{label:"Purchase Price"}),e.jsx("input",{type:"number",...o("purchasePrice",{required:"Purchase price is required"}),placeholder:"Purchase Price",className:"w-full p-2 border rounded"}),x.purchasePrice&&e.jsx("p",{className:"text-red-500",children:x.purchasePrice.message})]}),e.jsxs("div",{children:[e.jsx(T,{label:"Sales Price"}),e.jsx("input",{type:"number",...o("salesPrice",{required:"Sales price is required"}),placeholder:"Sales Price",className:"w-full p-2 border rounded"}),x.salesPrice&&e.jsx("p",{className:"text-red-500",children:x.salesPrice.message})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(T,{label:"Product Quantity"}),e.jsx("input",{type:"number",...o("productQuantity",{required:"Quantity is required"}),placeholder:"Product Quantity",className:"w-full p-2 border rounded"}),x.productQuantity&&e.jsx("p",{className:"text-red-500",children:x.productQuantity.message})]}),e.jsxs("div",{className:"mt-12",children:[e.jsx("input",{type:"file",accept:"image/*",...o("image"),className:"w-full p-2 border rounded"}),u&&e.jsx("img",{src:typeof u=="string"?u:URL.createObjectURL(u),alt:"preview",className:"w-32 h-32 object-cover mt-2 rounded border"})]})]}),e.jsxs("div",{children:[e.jsx(T,{label:"Product Description"}),e.jsx(K,{value:f,modules:h,formats:b,onChange:r=>{P(r),N("description",r)},placeholder:"Write something...",className:"h-[300px] mb-20"}),e.jsx("input",{type:"hidden",...o("description"),value:f})]})]}),e.jsx("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:c?"Updateing...":"Update"})]})]})})})},I="http://localhost:5055/api",ce=({products:a,refetch:l})=>{const p=E(),[w,u]=m.useState(!1);console.log(a);const[g,f]=m.useState(null),[P,c]=m.useState(!1),S=s=>{f(s),c(!0)},o=()=>{c(!1),f(null)},y=async s=>{F.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async N=>{if(N.isConfirmed){u(!0);try{(await p.delete(`${I}/products/${s}`)).status===200&&(F.fire("Deleted!","Product has been deleted.","success"),l())}catch{F.fire("Error!","There was a problem deleting the product.","error")}finally{u(!1)}}})};return w?e.jsx(e.Fragment,{children:e.jsx(H,{loading:w})}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{isOpen:P,onClose:o,children:g&&e.jsx(ne,{product:g,onClose:o,refetch:l})}),e.jsx(t.TableBody,{children:a==null?void 0:a.map((s,N)=>e.jsxs(t.TableRow,{children:[e.jsx(t.TableCell,{className:"font-semibold uppercase text-xs",children:s==null?void 0:s.id}),e.jsx(t.TableCell,{children:e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.image?e.jsx(t.Avatar,{className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none",src:I+(s==null?void 0:s.image),alt:"product"}):e.jsx(t.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product"}),e.jsx("div",{children:e.jsx("h2",{className:`text-sm font-medium ${(s==null?void 0:s.title.length)>30?"wrap-long-title":""}`})})]})}),e.jsx(t.TableCell,{children:e.jsx("span",{className:"text-sm",children:s==null?void 0:s.productName})}),e.jsx(t.TableCell,{children:e.jsx("span",{className:"text-sm font-semibold",children:s==null?void 0:s.purchasePrice})}),e.jsx(t.TableCell,{children:e.jsx("span",{className:"text-sm font-semibold",children:s==null?void 0:s.salesPrice})}),e.jsx(t.TableCell,{children:e.jsx("span",{className:"text-sm",children:s==null?void 0:s.productQuantity})}),e.jsx(t.TableCell,{children:s.productQuantity>0?e.jsx(t.Badge,{type:"success",children:R("Selling")}):e.jsx(t.Badge,{type:"danger",children:R("SoldOut")})}),e.jsxs(t.TableCell,{className:"flex gap-8",children:[e.jsx(t.Button,{layout:"link",size:"icon","aria-label":"Edit",onClick:()=>S(s),children:e.jsx(M,{className:"text-green-500 text-2xl"})}),e.jsx(t.Button,{layout:"link",size:"icon","aria-label":"Delete",onClick:()=>y(s==null?void 0:s.id),children:e.jsx($,{className:"text-red-500 text-2xl"})})]})]},N+1))})]})},de={type:"object",properties:{categories:{type:"array"},image:{type:"array"},tag:{type:"array"},variants:{type:"array"},show:{type:"array"},status:{type:"string"},prices:{type:"object"},isCombination:{type:"boolean"},title:{type:"object"},productId:{type:"string"},slug:{type:"string"},category:{type:"object"},stock:{type:"number"},description:{type:"object"}},required:["categories","category","prices","title"]},me=a=>{const l=new ee({allErrors:!0}),{setLoading:p,setIsUpdate:w}=m.useContext(J),[u]=m.useState([]),[g,f]=m.useState([]),[P,c]=m.useState(""),[S,o]=m.useState(!1),{handleDisableForDemo:y}=te();return{data:a,filename:P,isDisabled:S,handleSelectFile:async h=>{var j;h.preventDefault();const b=new FileReader,r=(j=h.target)==null?void 0:j.files[0];r&&r.type==="application/json"?(c(r==null?void 0:r.name),o(!0),b.readAsText(r,"UTF-8"),b.onload=d=>{const D=JSON.parse(d.target.result).map(i=>({categories:i.categories,image:i.image,barcode:i.barcode,tag:i.tag,variants:i.variants,status:i.status,prices:i.prices,isCombination:JSON.parse(i.isCombination.toLowerCase()),title:i.title,productId:i.productId,slug:i.slug,sku:i.sku,category:i.category,stock:i.stock,description:i.description}));f(D)}):r&&r.type==="text/csv"?(c(r==null?void 0:r.name),o(!0),b.onload=async d=>{const k=d.target.result,i=(await se().fromString(k)).map(n=>({categories:JSON.parse(n.categories),image:JSON.parse(n.image),barcode:n.barcode,tag:JSON.parse(n.tag),variants:JSON.parse(n.variants),status:n.status,prices:JSON.parse(n.prices),isCombination:JSON.parse(n.isCombination.toLowerCase()),title:JSON.parse(n.title),productId:n.productId,slug:n.slug,sku:n.sku,category:JSON.parse(n.category),stock:JSON.parse(n.stock),description:JSON.parse(n.description)}));f(i)},b.readAsText(r)):(c(r==null?void 0:r.name),o(!0),C("Unsupported file type!"))},serviceData:a,handleOnDrop:h=>{for(let b=0;b<h.length;b++)u.push(h[b].data)},handleUploadProducts:()=>{if(!y())if(u.length<1)C("Please upload/select csv file first!");else{if(y())return;Q.addAllProducts(u).then(h=>{O(h.message)}).catch(h=>C(h.message))}},handleRemoveSelectFile:h=>{c(""),f([]),setTimeout(()=>o(!1),1e3)},handleUploadMultiple:h=>{if(!y())if(g.length>1){p(!0);let b=g.map(d=>l.validate(de,d));const r=d=>d===!0;b.every(r)?Q.addAllProducts(g).then(d=>{w(!0),p(!1),O(d.message)}).catch(d=>{p(!1),C(d.message)}):(p(!1),C("Please enter valid data!"))}else p(!1),C("Please select a valid json, csv & xls file first!")}}},es=()=>{const{allId:a}=V(),{t:l}=q(),{toggleDrawer:p,lang:w,setCategory:u,searchRef:g,handleSubmitForAll:f,setSortedField:P}=m.useContext(J),{data:c,isLoading:S,error:o,refetch:y}=G("/products/get/all","allProducts"),s=()=>{u(""),P(""),g.current.value=""},{serviceData:N}=me(c==null?void 0:c.products);return e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:l("ProductsPage")}),e.jsx(re,{ids:a,title:"Products"}),e.jsx(X,{children:e.jsx(Z,{productsrefetch:y})}),e.jsxs(le,{children:[e.jsx(t.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(t.CardBody,{className:"",children:e.jsxs("form",{onSubmit:f,className:"py-3 md:pb-0 grid gap-4 lg:gap-6 xl:gap-6 xl:flex",children:[e.jsx("div",{className:"flex-grow-0 sm:flex-grow md:flex-grow lg:flex-grow xl:flex-grow"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsxs(t.Button,{onClick:p,className:"w-full rounded-md h-12",children:[e.jsx("span",{className:"mr-2",children:e.jsx(z,{})}),l("AddProduct")]})})})]})})}),e.jsx(t.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 rounded-t-lg rounded-0 mb-4",children:e.jsx(t.CardBody,{children:e.jsxs("form",{onSubmit:f,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsxs("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx(t.Input,{ref:g,type:"search",name:"search",placeholder:"Search Product"}),e.jsx("button",{type:"submit",className:"absolute right-0 top-0 mt-5 mr-1"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx("div",{className:"w-full mx-1",children:e.jsx(t.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:"Filter"})}),e.jsx("div",{className:"w-full mx-1",children:e.jsx(t.Button,{layout:"outline",onClick:s,type:"reset",className:"px-4 md:py-1 py-2 h-12 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:"Reset"})})})]})]})})})]}),S?e.jsx(ae,{row:12,col:7,width:160,height:20}):o?e.jsx("span",{className:"text-center mx-auto text-red-500",children:o}):(N==null?void 0:N.length)!==0?e.jsx(t.TableContainer,{className:"mb-8 rounded-b-lg",children:e.jsxs(t.Table,{children:[e.jsx(t.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(t.TableCell,{children:l("ID")}),e.jsx(t.TableCell,{children:l("Image")}),e.jsx(t.TableCell,{children:l("ProductNameTbl")}),e.jsx(t.TableCell,{children:l("PriceTbl")}),e.jsx(t.TableCell,{children:l("Sale Price")}),e.jsx(t.TableCell,{children:l("QuntityTbl")}),e.jsx(t.TableCell,{children:l("StatusTbl")}),e.jsx(t.TableCell,{children:l("ActionsTbl")})]})}),e.jsx(ce,{lang:w,refetch:y,products:c==null?void 0:c.rows})]})}):e.jsx(_,{title:"Product"})]})};export{es as default};
